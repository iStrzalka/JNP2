DROP TABLE IF EXISTS ADVERTS CASCADE;
DROP TABLE IF EXISTS BRAND CASCADE;
DROP TABLE IF EXISTS CAR_MODEL CASCADE;
DROP TABLE IF EXISTS DEALERSHIP CASCADE;
DROP TABLE IF EXISTS ENGINE CASCADE;
DROP TABLE IF EXISTS LOCATION CASCADE;
DROP TABLE IF EXISTS OPINIONS CASCADE;

CREATE TABLE ADVERTS
(
    ADVERT_ID                DECIMAL        NOT NULL PRIMARY KEY,
    PRICE                    DECIMAL        NOT NULL,
    DESCRIPTION              VARCHAR(10000),
    CAR_MODEL_CAR_ID         DECIMAL(38, 0) NOT NULL,
    DEALERSHIP_DEALERSHIP_ID DECIMAL(38, 0) NOT NULL,
	TAKEN_UNTIL 			 TIMESTAMP WITH TIME ZONE
);

CREATE TABLE BRAND
(
    BRAND_ID DECIMAL(38, 0) NOT NULL PRIMARY KEY,
    NAME     VARCHAR(32)    NOT NULL,
    COUNTRY  VARCHAR(32)    NOT NULL
);

CREATE TABLE CAR_MODEL
(
    CAR_ID           DECIMAL(38, 0) NOT NULL PRIMARY KEY,
    NAME             VARCHAR(32)    NOT NULL,
    PRODUCTION_YEAR  DECIMAL(38, 0),
    SEATS            DECIMAL(38, 0) NOT NULL,
    ENGINE_ENGINE_ID DECIMAL(38, 0) NOT NULL,
    BRAND_BRAND_ID   DECIMAL(38, 0) NOT NULL
);

CREATE TABLE DEALERSHIP
(
    DEALERSHIP_ID        DECIMAL(38, 0) NOT NULL PRIMARY KEY,
    NAME                 VARCHAR(32),
    PHONE_NO             CHAR(9)        NOT NULL,
    LOCATION_LOCATION_ID DECIMAL(38, 0) NOT NULL,
    AVG_RATING           NUMERIC(3, 2)
);

CREATE TABLE ENGINE
(
    ENGINE_ID   DECIMAL(38, 0) NOT NULL PRIMARY KEY,
    HP          DECIMAL(38, 0),
    ENGINE_SIZE DECIMAL(38, 0),
    FUEL_TYPE   VARCHAR(32)
);

CREATE TABLE LOCATION
(
    LOCATION_ID DECIMAL(38, 0) NOT NULL PRIMARY KEY,
    COUNTRY     VARCHAR(32)    NOT NULL,
    REGION      VARCHAR(32),
    CITY        VARCHAR(32),
    COORD_X     NUMERIC(16, 14)  NOT NULL,
    COORD_Y     NUMERIC(16, 14)  NOT NULL
);

CREATE TABLE OPINIONS
(
    OPINION_ID               DECIMAL(38, 0) NOT NULL PRIMARY KEY,
    NICKNAME                 VARCHAR(32)    NOT NULL,
    RATING                   DECIMAL(38, 0),
    REVIEW                   VARCHAR(32),
    DEALERSHIP_DEALERSHIP_ID DECIMAL(38, 0) NOT NULL
);

Insert into BRAND (BRAND_ID,NAME,COUNTRY) values ('1','Fiat','Wlochy');
Insert into BRAND (BRAND_ID,NAME,COUNTRY) values ('2','Toyota','Japonia');
Insert into BRAND (BRAND_ID,NAME,COUNTRY) values ('3','Volkswagen','Nimecy');
Insert into BRAND (BRAND_ID,NAME,COUNTRY) values ('4','Tesla','USA');
Insert into BRAND (BRAND_ID,NAME,COUNTRY) values ('5','BMW','Niemcy');

-- insert engines
Insert into ENGINE (ENGINE_ID,HP,ENGINE_SIZE,FUEL_TYPE) values ('1','200','1200','Diesel');
Insert into ENGINE (ENGINE_ID,HP,ENGINE_SIZE,FUEL_TYPE) values ('2','430','4500','Benzyna');
Insert into ENGINE (ENGINE_ID,HP,ENGINE_SIZE,FUEL_TYPE) values ('3','70','1200','Benzyna');
Insert into ENGINE (ENGINE_ID,HP,ENGINE_SIZE,FUEL_TYPE) values ('4','140','2000','Diesel');
Insert into ENGINE (ENGINE_ID,HP,ENGINE_SIZE,FUEL_TYPE) values ('5','140','1900','Diesel');

-- insert cars
Insert into CAR_MODEL (CAR_ID,NAME,PRODUCTION_YEAR,SEATS,ENGINE_ENGINE_ID,BRAND_BRAND_ID) values ('1','Panda','2004','4','1','1');
Insert into CAR_MODEL (CAR_ID,NAME,PRODUCTION_YEAR,SEATS,ENGINE_ENGINE_ID,BRAND_BRAND_ID) values ('2', 'Model 3', '2013', '4', '1', '4');
Insert into CAR_MODEL (CAR_ID,NAME,PRODUCTION_YEAR,SEATS,ENGINE_ENGINE_ID,BRAND_BRAND_ID) values ('3','Golf','2000','4','3','3');
Insert into CAR_MODEL (CAR_ID,NAME,PRODUCTION_YEAR,SEATS,ENGINE_ENGINE_ID,BRAND_BRAND_ID) values ('4','Supra','1997','3','2','2');

-- insert locations
Insert into LOCATION (LOCATION_ID,COUNTRY,REGION,CITY,COORD_X,COORD_Y) values ('1','PL','Mazowieckie','Pruszków','52.1678','20.8318');
Insert into LOCATION (LOCATION_ID,COUNTRY,REGION,CITY,COORD_X,COORD_Y) values ('2','PL','Dolnośląskie','Wrocław','51.12166987386262','17.03374760078423');

-- insert dealerships
Insert into DEALERSHIP (DEALERSHIP_ID,NAME,PHONE_NO,LOCATION_LOCATION_ID,AVG_RATING) values ('1','slabawypozyczalnia','997998999','1','3.5');
Insert into DEALERSHIP (DEALERSHIP_ID,NAME,PHONE_NO,LOCATION_LOCATION_ID,AVG_RATING) values ('2','superwypozyczalnia','123456789','2','4.6');

-- insert advertisments
Insert into ADVERTS (ADVERT_ID,PRICE,DESCRIPTION,CAR_MODEL_CAR_ID,DEALERSHIP_DEALERSHIP_ID, TAKEN_UNTIL) values ('1','805','Opis samochodu','1','1', CURRENT_TIMESTAMP);
Insert into ADVERTS (ADVERT_ID,PRICE,DESCRIPTION,CAR_MODEL_CAR_ID,DEALERSHIP_DEALERSHIP_ID, TAKEN_UNTIL) values ('2','100','Opis','1','1', CURRENT_TIMESTAMP);
Insert into ADVERTS (ADVERT_ID,PRICE,DESCRIPTION,CAR_MODEL_CAR_ID,DEALERSHIP_DEALERSHIP_ID, TAKEN_UNTIL) values ('3','400','Opis2','1','1', CURRENT_TIMESTAMP);
Insert into ADVERTS (ADVERT_ID,PRICE,DESCRIPTION,CAR_MODEL_CAR_ID,DEALERSHIP_DEALERSHIP_ID, TAKEN_UNTIL) values ('4','2137','Dfsada','1','1', CURRENT_TIMESTAMP);
Insert into ADVERTS (ADVERT_ID,PRICE,DESCRIPTION,CAR_MODEL_CAR_ID,DEALERSHIP_DEALERSHIP_ID, TAKEN_UNTIL) values ('5','9000','Ultra szybkie auto','1','1', CURRENT_TIMESTAMP);
Insert into ADVERTS (ADVERT_ID,PRICE,DESCRIPTION,CAR_MODEL_CAR_ID,DEALERSHIP_DEALERSHIP_ID, TAKEN_UNTIL) values ('6','7312','Myszo jeleń','1','1', CURRENT_TIMESTAMP);
Insert into ADVERTS (ADVERT_ID,PRICE,DESCRIPTION,CAR_MODEL_CAR_ID,DEALERSHIP_DEALERSHIP_ID, TAKEN_UNTIL) values ('21','8054','Bardzo specyficzny opis','1','1', CURRENT_TIMESTAMP);
Insert into ADVERTS (ADVERT_ID,PRICE,DESCRIPTION,CAR_MODEL_CAR_ID,DEALERSHIP_DEALERSHIP_ID, TAKEN_UNTIL) values ('22','200','Czy ten opis jest potrzebny?','1','1', CURRENT_TIMESTAMP);
Insert into ADVERTS (ADVERT_ID,PRICE,DESCRIPTION,CAR_MODEL_CAR_ID,DEALERSHIP_DEALERSHIP_ID, TAKEN_UNTIL) values ('7','420','Kolejny opis samochodu','2','2', CURRENT_TIMESTAMP);
Insert into ADVERTS (ADVERT_ID,PRICE,DESCRIPTION,CAR_MODEL_CAR_ID,DEALERSHIP_DEALERSHIP_ID, TAKEN_UNTIL) values ('8','3999','Brak opiu','2','2', CURRENT_TIMESTAMP);
Insert into ADVERTS (ADVERT_ID,PRICE,DESCRIPTION,CAR_MODEL_CAR_ID,DEALERSHIP_DEALERSHIP_ID, TAKEN_UNTIL) values ('9','20013','50kmh to max','3','2', CURRENT_TIMESTAMP);
Insert into ADVERTS (ADVERT_ID,PRICE,DESCRIPTION,CAR_MODEL_CAR_ID,DEALERSHIP_DEALERSHIP_ID, TAKEN_UNTIL) values ('10','3942','Szybki samochod','4','2', CURRENT_TIMESTAMP);
Insert into ADVERTS (ADVERT_ID,PRICE,DESCRIPTION,CAR_MODEL_CAR_ID,DEALERSHIP_DEALERSHIP_ID, TAKEN_UNTIL) values ('11','111','Swietne auto mniam','4','2', CURRENT_TIMESTAMP);

-- insert opinions
Insert into OPINIONS (OPINION_ID, NICKNAME, RATING, REVIEW, DEALERSHIP_DEALERSHIP_ID) values ('1', 'moj ojciec', 5, 'bylo bardzo dobrze :)', 1);
Insert into OPINIONS (OPINION_ID, NICKNAME, RATING, REVIEW, DEALERSHIP_DEALERSHIP_ID) values ('2', 'twoj ojciec', 1, 'bylo bardzo zle :)', 1);
Insert into OPINIONS (OPINION_ID, NICKNAME, RATING, REVIEW, DEALERSHIP_DEALERSHIP_ID) values ('3', 'czyjs ojciec', 3, 'bylo ok', 2);
Insert into OPINIONS (OPINION_ID, NICKNAME, RATING, REVIEW, DEALERSHIP_DEALERSHIP_ID) values ('4', 'czyjas matka', 4, 'bylo ok', 2);

CREATE UNIQUE INDEX ADVERTS_PK ON ADVERTS (ADVERT_ID);
CREATE UNIQUE INDEX BRAND_PK ON BRAND (BRAND_ID);
CREATE UNIQUE INDEX CAR_MODEL_PK ON CAR_MODEL (CAR_ID);
CREATE UNIQUE INDEX DEALERSHIP_PK ON DEALERSHIP (DEALERSHIP_ID);
CREATE UNIQUE INDEX ENGINE_PK ON ENGINE (ENGINE_ID);
CREATE UNIQUE INDEX LOCATION_PK ON LOCATION (LOCATION_ID);
CREATE UNIQUE INDEX OPINIONS_PK ON OPINIONS (OPINION_ID);

ALTER TABLE ADVERTS
    ADD CONSTRAINT ADVERTS_CAR_MODEL_FK FOREIGN KEY (CAR_MODEL_CAR_ID) REFERENCES CAR_MODEL (CAR_ID);
ALTER TABLE ADVERTS
    ADD CONSTRAINT ADVERTS_DEALERSHIP_FK FOREIGN KEY (DEALERSHIP_DEALERSHIP_ID) REFERENCES DEALERSHIP (DEALERSHIP_ID);
ALTER TABLE CAR_MODEL
    ADD CONSTRAINT CAR_MODEL_BRAND_FK FOREIGN KEY (BRAND_BRAND_ID) REFERENCES BRAND (BRAND_ID);
ALTER TABLE CAR_MODEL
    ADD CONSTRAINT CAR_MODEL_ENGINE_FK FOREIGN KEY (ENGINE_ENGINE_ID) REFERENCES ENGINE (ENGINE_ID);
ALTER TABLE DEALERSHIP
    ADD CONSTRAINT DEALERSHIP_LOCATION_FK FOREIGN KEY (LOCATION_LOCATION_ID) REFERENCES LOCATION (LOCATION_ID);
ALTER TABLE OPINIONS
    ADD CONSTRAINT OPINIONS_DEALERSHIP_FK FOREIGN KEY (DEALERSHIP_DEALERSHIP_ID) REFERENCES DEALERSHIP (DEALERSHIP_ID);
	